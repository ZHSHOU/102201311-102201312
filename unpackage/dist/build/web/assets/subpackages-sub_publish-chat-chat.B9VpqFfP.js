import{d as e,A as a,h as t,ax as s,U as l,c as n,C as o,o as u,a as i,w as r,b as c,l as d,n as v,a6 as m,i as p,K as g,Y as f,j as h,e as y,m as w,p as _,F as x,f as $,s as b,q as I,S as k,af as S,Q as j,t as A,ay as C}from"./index-CzFVNye6.js";import{b as T,m as Y,e as z,a as D,c as L,u as U,A as X,B,d as F,o as H}from"./props.Cxz2570m.js";import{_ as O}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{r as P}from"./uni-app.es.xDvG45QC.js";import{_ as W}from"./default-avatar.DPaE08He.js";import{c as E}from"./config.defalut.DCXQerkV.js";import{s as M}from"./store.DJP51awm.js";const R=O(e({name:"wd-watermark",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...T,content:Y(""),image:Y(""),imageHeight:z(100),imageWidth:z(100),gutterX:z(0),gutterY:z(0),width:z(100),height:z(100),fullScreen:D(!0),color:Y("#8c8c8c"),size:z(14),fontStyle:Y("normal"),fontWeight:L("normal"),fontFamily:Y("PingFang SC"),rotate:z(-25),zIndex:z(1100),opacity:z(.5)},setup(e){const f=e;a((()=>f),(()=>{b.value=!0,x.value=(f.height+f.gutterY)*_.value,$.value=(f.width+f.gutterX)*_.value,g((()=>{S()}))}),{deep:!0});const h=t(`water${U()}`),y=t(""),w=t(s("createOffscreenCanvas")&&Boolean(uni.createOffscreenCanvas)),_=t(l().pixelRatio),x=t((f.height+f.gutterY)*_.value),$=t((f.width+f.gutterX)*_.value),b=t(!0),I=n((()=>{let e="wd-watermark";return f.fullScreen&&(e=`${e} is-fullscreen`),`${e} ${f.customClass}`})),k=n((()=>{const e={opacity:f.opacity,backgroundSize:F(f.width+f.gutterX)};return y.value&&(e.backgroundImage=`url('${y.value}')`),`${H(e)};${f.customStyle}`}));function S(){b.value=!1;const{width:e,height:a,color:t,size:s,fontStyle:l,fontWeight:n,fontFamily:o,content:u,rotate:i,gutterX:r,gutterY:c,image:d,imageHeight:v,imageWidth:m}=f;!function(e,a,t,s,l,n,o,u,i,r,c,d,v,m){const p=(a+c)*_.value,g=(e+r)*_.value,f=e*_.value,h=a*_.value,w=s*_.value;!function(e,a,t,s,l,n,o,u,i,r,c,d,v,m){const p=document.createElement("canvas"),g=p.getContext("2d");if(p.setAttribute("width",`${a}px`),p.setAttribute("height",`${e}px`),g)if(d){!async function(e,a,t,s,l,n,o,u,i){e.translate(o/2,u/2),e.rotate(Math.PI/180*Number(n)),a.crossOrigin="anonymous",a.referrerPolicy="no-referrer",X(t)?a.src=t:a.src=B(t,{timestamp:`${(new Date).getTime()}`});a.onload=()=>{e.drawImage(a,-l*_.value/2,-s*_.value/2,l*_.value,s*_.value),e.restore(),y.value=i.toDataURL()}}(g,new Image,d,v,m,l,t,s,p)}else!function(e,a,t,s,l,n,o,u,i,r,c){e.textBaseline="middle",e.textAlign="center",e.translate(t/2,t/2),e.rotate(Math.PI/180*l),e.font=`${u} normal ${i} ${n}px/${s}px ${o}`,e.fillStyle=r,e.fillText(a,0,0),e.restore(),y.value=c.toDataURL()}(g,c,t,s,l,n,o,u,i,r,p);else console.error("无法获取canvas上下文，请确认当前环境是否支持canvas")}(p,g,f,h,i,w,o,l,n,t,u,d,v,m)}(e,a,t,s,l,n,o,u,i,r,c,d,v,m)}return o((()=>{S()})),(e,a)=>{const t=m,s=p;return u(),i(s,{class:v(I.value),style:c(k.value)},{default:r((()=>[!w.value&&b.value?(u(),i(t,{key:0,type:"2d",style:c({height:x.value+"px",width:$.value+"px",visibility:"hidden"}),"canvas-id":h.value,id:h.value},null,8,["style","canvas-id","id"])):d("",!0)])),_:1},8,["class","style"])}}}),[["__scopeId","data-v-278c0ba1"]]),V=O(e({__name:"chat",setup(e){const a=f.importObject("travel-utils",{customUI:!0}),s=n((()=>M.userInfo)),l=`${s.value.nickname||s.value.username||s.value.mobile}@${E.SYSTEM_TITLE}`,o=t(""),c=t(""),m=t([]),T=t(!1),Y=async()=>{if(o.value.trim()){m.value.push({type:"send",content:o.value,create_time:Date.now()});const e=o.value;D(),o.value="",T.value=!0,m.value.push({type:"load",content:"",create_time:Date.now()}),await z(e)}},z=async e=>{const t=m.value.length-1;await a.getAIAnswer(e).then((e=>{m.value[t].type="received",m.value[t].content=0===e.code?e.message:"系统出错，请稍后再试！"})).catch((()=>{m.value[t].type="received",m.value[t].content="系统出错，请稍后再试！"})).finally((()=>{T.value=!1,D(),2===m.value.length&&setTimeout((()=>{b({title:"可长按复制哦！",duration:2e3,icon:"none"})}),800)}))},D=()=>{g((()=>{c.value="last-msg-item",g((()=>{c.value=""}))}))};return(e,a)=>{const t=P(h("wd-watermark"),R),s=p,n=I,g=k,f=S,z=j;return u(),i(s,{class:"container"},{default:r((()=>[y(t,{content:l,width:120,height:120,opacity:.2,size:12}),y(g,{"scroll-into-view":c.value,class:"chat-list","scroll-y":"true","enable-flex":!0},{default:r((()=>[(u(!0),w(x,null,_(m.value,((e,a)=>(u(),i(s,{class:"message",key:a},{default:r((()=>[y(s,{class:v(["message-content",{"right-message":"send"===e.type}]),onLongpress:a=>{return t=a,s=e.content,void("longpress"===t.type&&C({data:s,success:function(){b({title:"复制成功",icon:"none"})}}));var t,s}},{default:r((()=>["load"===e.type?(u(),i(s,{key:0,class:"loader"})):(u(),i(s,{key:1},{default:r((()=>[$(A(e.content),1)])),_:2},1024))])),_:2},1032,["class","onLongpress"])])),_:2},1024)))),128)),m.value.length?d("",!0):(u(),i(s,{key:0,class:"tip-ai-ing"},{default:r((()=>[y(s,null,{default:r((()=>[y(n,{src:W}),$(" 灵感涌现时，让AI助您妙笔生花。分享您的灵感，共创精彩篇章！ ")])),_:1}),y(s,{class:"tip-text custom-text"},{default:r((()=>[$("富强、民主、文明、和谐")])),_:1}),y(s,{class:"tip-text"},{default:r((()=>[$("自由、平等、公正、法制")])),_:1}),y(s,{class:"tip-text"},{default:r((()=>[$("爱国、敬业、诚信、友善")])),_:1})])),_:1})),y(s,{id:"last-msg-item",style:{height:"1px"}})])),_:1},8,["scroll-into-view"]),y(s,{class:"input-wrapper"},{default:r((()=>[y(f,{type:"text",placeholder:"请输入消息",modelValue:o.value,"onUpdate:modelValue":a[0]||(a[0]=e=>o.value=e),maxlength:"50",cursorSpacing:20},null,8,["modelValue"]),y(z,{disabled:!o.value.trim().length||T.value,onClick:Y},{default:r((()=>[$("发送")])),_:1},8,["disabled"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-7a7e7140"]]);export{V as default};
