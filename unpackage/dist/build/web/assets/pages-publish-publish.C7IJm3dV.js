import{d as e,j as l,o as a,a as t,w as o,e as s,i as n,c as u,I as i,b as r,n as c,h as d,A as v,l as m,m as p,p as f,F as h,K as y,R as g,f as b,t as w,B as _,T as k,r as C,k as V,U as $,C as x,u as S,Y as I,J as z,L as T,V as K,W as A,z as j,N as B,s as O,Q as F}from"./index-CzFVNye6.js";import{_ as H}from"./wd-icon.C3a6lim4.js";import{r as N,e as E,f as P}from"./uni-app.es.xDvG45QC.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{_ as D}from"./wd-navbar.CACEQZVj.js";import{_ as q}from"./unregistered-page.CLnA5iNC.js";import{_ as M,a as R,b as W}from"./wd-form.CzoQC49t.js";import{b as G,a as U,c as J,l as Q,d as Y,o as X,m as Z,e as ee,p as le,q as ae,r as te,s as oe,t as se,v as ne,w as ue,x as ie,i as re,y as ce}from"./props.Cxz2570m.js";import{_ as de}from"./wd-cell.CHbQx4mY.js";import{u as ve,F as me}from"./types.DUQKCkIl.js";import{u as pe}from"./useChildren.BEcQKJfk.js";import{u as fe}from"./useTranslate.CXMl9qFr.js";import{_ as he}from"./custom-editor.vue_vue_type_script_setup_true_name_custom-editor_lang.B4uVawBd.js";import{s as ye,c as ge,d as be,e as we}from"./index.CTSRJkC8.js";import"./config.defalut.DCXQerkV.js";const _e=L(e({name:"wd-navbar-capsule",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},emits:["back","back-home"],setup(e,{emit:u}){const i=u;function r(){i("back")}function c(){i("back-home")}return(e,u)=>{const i=N(l("wd-icon"),H),d=n;return a(),t(d,{class:"wd-navbar-capsule"},{default:o((()=>[s(i,{onClick:r,size:"20px",name:"chevron-left","custom-class":"wd-navbar-capsule__icon"}),s(i,{onClick:c,size:"20px",name:"home","custom-class":"wd-navbar-capsule__icon"})])),_:1})}}}),[["__scopeId","data-v-da7d0fe7"]]),ke=L(e({name:"wd-switch",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...G,modelValue:{type:[Boolean,String,Number],required:!0,default:!1},disabled:U(!1),activeValue:{type:[Boolean,String,Number],default:!0},inactiveValue:{type:[Boolean,String,Number],default:!1},activeColor:String,inactiveColor:String,size:J(28),beforeChange:Function},emits:["change","update:modelValue"],setup(e,{emit:l}){const d=e,v=u((()=>`wd-switch ${d.customClass} ${d.disabled?"is-disabled":""} ${d.modelValue===d.activeValue?"is-checked":""}`)),m=u((()=>{const e={"font-size":Y(d.size),background:d.modelValue===d.activeValue?d.activeColor:d.inactiveColor,"border-color":d.modelValue===d.activeValue?d.activeColor:d.inactiveColor};return`${X(e)};${d.customStyle}`})),p=u((()=>d.modelValue===d.activeValue&&d.activeColor||d.modelValue!==d.activeValue&&d.inactiveColor?"box-shadow: none;":"")),f=l;function h(){if(d.disabled)return;const e=d.modelValue===d.activeValue?d.inactiveValue:d.activeValue;d.beforeChange&&Q(d.beforeChange)?d.beforeChange({value:e,resolve:l=>{l&&(f("update:modelValue",e),f("change",{value:e}))}}):(f("update:modelValue",e),f("change",{value:e}))}return i((()=>{-1===[d.activeValue,d.inactiveValue].indexOf(d.modelValue)&&(f("update:modelValue",d.inactiveValue),f("change",{value:d.inactiveValue}))})),(e,l)=>{const u=n;return a(),t(u,{class:c(v.value),style:r(m.value),onClick:h},{default:o((()=>[s(u,{class:"wd-switch__circle",style:r(p.value)},null,8,["style"])])),_:1},8,["class","style"])}}}),[["__scopeId","data-v-5055bfc8"]]);function Ce(e,l,a){let t=ae(e)?e:[e];const o=new Set(e.map(te));if(1!==o.size&&o.has("object"))throw Error("The columns are correct");ae(e[0])||(t=[t]);return t.map((e=>e.map((e=>{if(!oe(e))return{[l]:e,[a]:e};if(!e.hasOwnProperty(l)&&!e.hasOwnProperty(a))throw Error("Can't find valueKey and labelKey in columns");return e.hasOwnProperty(a)||(e[a]=e[l]),e.hasOwnProperty(l)||(e[l]=e[a]),e}))))}const Ve=L(e({name:"wd-picker-view",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...G,loading:U(!1),loadingColor:Z("#4D80F0"),columnsHeight:ee(217),valueKey:Z("value"),labelKey:Z("label"),modelValue:{type:[String,Number,Boolean,Array,Array,Array],default:"",required:!0},columns:le(),columnChange:Function},emits:["change","pickstart","pickend","update:modelValue"],setup(e,{expose:u,emit:i}){const C=e,V=d([]),$=d(35),x=d([]),S=d([]),I=i;v((()=>C.modelValue),((e,l)=>{!ue(l,e)&&e&&T(e)}),{deep:!0,immediate:!0}),v((()=>C.columns),(e=>{V.value=Ce(e,C.valueKey,C.labelKey),T(C.modelValue)}),{deep:!0,immediate:!0}),v((()=>x.value),(e=>{ue(e,S.value)||ue(O(),C.modelValue)||j(0)}),{deep:!0,immediate:!0}),v((()=>C.columnChange),(e=>{e&&!Q(e)&&console.error("The type of columnChange must be Function")}),{deep:!0,immediate:!0});const{proxy:z}=_();function T(e){if(0===C.columns.length)return;(""===e||null==e||ae(e)&&0===e.length)&&(e=V.value.map((e=>e[0][C.valueKey])));const l=te(e),a=["string","number","boolean","array"];-1===a.indexOf(l)&&console.error(`value must be one of ${a.toString()}`),0===V.value.length&&(V.value=Ce(C.columns,C.valueKey,C.labelKey)),0===(e=(e=ae(e)?e:[e]).slice(0,V.value.length)).length&&(e=V.value.map((()=>0)));let t=se(x.value);e.forEach(((e,l)=>{let a=V.value[l].findIndex((l=>l[C.valueKey].toString()===e.toString()));a=-1===a?0:a,t=K(l,a)})),x.value=t.slice(0,e.length)}function K(e,l){const a=V.value[e];if(!a||!a[l])throw Error(`The value to select with Col:${e} Row:${l} is correct`);const t=se(x.value);if(a[l].disabled){const o=a.slice(0,l).reverse().findIndex((e=>!e.disabled)),s=a.slice(l+1).findIndex((e=>!e.disabled));-1!==o?t[e]=l-1-o:-1!==s?t[e]=l+1+s:void 0===t[e]&&(t[e]=0)}else t[e]=l;return x.value=se(t),x.value}function A({detail:{value:e}}){const l=function(e){e=e.slice(0,V.value.length);const l=se(x.value);let a=se(x.value);e.forEach(((e,t)=>{(e=ne(e,0,V.value[t].length-1))!==l[t]&&(a=K(t,e))})),x.value=a,S.value=l;const t=function(e,l){if(!e||!l)return-1;return e.findIndex(((e,a)=>e!==l[a]))}(a,l);if(-1===t)return;const o=a[t];return 1===a.length?o:t}(e=e.map((e=>Number(e||0))));x.value=se(e),y((()=>{C.columnChange?C.columnChange.length<4?(C.columnChange(z.$.exposed,B(),l||0,(()=>{})),j(l||0)):C.columnChange(z.$.exposed,B(),l||0,(()=>{j(l||0)})):j(l||0)}))}function j(e){const l=O();ue(l,C.modelValue)||(I("update:modelValue",l),setTimeout((()=>{I("change",{picker:z.$.exposed,value:l,index:e})}),0))}function B(){const e=x.value.map(((e,l)=>V.value[l][e]));return 1===e.length?e[0]:e}function O(){const{valueKey:e}=C,l=x.value.map(((l,a)=>V.value[a][l][e]));return 1===l.length?l[0]:l}function F(){I("pickstart")}function H(){I("pickend")}return u({getSelects:B,getValues:O,setColumnData:function(e,l,a=0){x.value=K(e,a),V.value[e]=Ce(l,C.valueKey,C.labelKey).reduce(((e,l)=>e.concat(l)),[])},getColumnsData:function(){return V.value.slice(0)},getColumnData:function(e){return V.value[e]},getColumnIndex:function(e){return x.value[e]},getLabels:function(){const{labelKey:e}=C;return x.value.map(((l,a)=>V.value[a][l][e]))},getSelectedIndex:function(){return x.value}}),(e,u)=>{const i=N(l("wd-loading"),M),d=n,v=k,y=g;return a(),t(d,{class:c(`wd-picker-view ${e.customClass}`),style:r(e.customStyle)},{default:o((()=>[e.loading?(a(),t(d,{key:0,class:"wd-picker-view__loading"},{default:o((()=>[s(i,{color:e.loadingColor},null,8,["color"])])),_:1})):m("",!0),s(d,{style:r(`height: ${e.columnsHeight-20}px;`)},{default:o((()=>[s(y,{"mask-class":"wd-picker-view__mask","indicator-class":"wd-picker-view__roller","indicator-style":`height: ${$.value}px;`,style:r(`height: ${e.columnsHeight-20}px;`),value:x.value,onChange:A,onPickstart:F,onPickend:H},{default:o((()=>[(a(!0),p(h,null,f(V.value,((l,s)=>(a(),t(v,{key:s,class:"wd-picker-view-column"},{default:o((()=>[(a(!0),p(h,null,f(l,((l,n)=>(a(),t(d,{key:n,class:c(`wd-picker-view-column__item ${l.disabled?"wd-picker-view-column__item--disabled":""}  ${x.value[s]==n?"wd-picker-view-column__item--active":""}`),style:r(`line-height: ${$.value}px;`)},{default:o((()=>[b(w(l[e.labelKey]),1)])),_:2},1032,["class","style"])))),128))])),_:2},1024)))),128))])),_:1},8,["indicator-style","style","value"])])),_:1},8,["style"])])),_:1},8,["class","style"])}}}),[["__scopeId","data-v-f37587df"]]),$e=L(e({name:"wd-transition",options:{addGlobalClass:!0,virtualHost:!0,styleIsolation:"shared"},props:{...G,show:U(!1),duration:{type:[Object,Number,Boolean],default:300},name:Z("fade"),lazyRender:U(!0),enterClass:Z(""),enterActiveClass:Z(""),enterToClass:Z(""),leaveClass:Z(""),leaveActiveClass:Z(""),leaveToClass:Z("")},emits:["click","before-enter","enter","before-leave","leave","after-leave","after-enter"],setup(e,{emit:l}){const s=e=>e?{enter:`wd-${e}-enter wd-${e}-enter-active`,"enter-to":`wd-${e}-enter-to wd-${e}-enter-active`,leave:`wd-${e}-leave wd-${e}-leave-active`,"leave-to":`wd-${e}-leave-to wd-${e}-leave-active`}:{enter:`${p.enterClass} ${p.enterActiveClass}`,"enter-to":`${p.enterToClass} ${p.enterActiveClass}`,leave:`${p.leaveClass} ${p.leaveActiveClass}`,"leave-to":`${p.leaveToClass} ${p.leaveActiveClass}`},p=e,f=d(!1),h=d(!1),y=d(""),g=d(!1),b=d(300),w=d(""),_=d(null),k=l,V=u((()=>`-webkit-transition-duration:${b.value}ms;transition-duration:${b.value}ms;${h.value?"":"display: none;"}${p.customStyle}`)),$=u((()=>`wd-transition ${p.customClass}  ${w.value}`));function x(){k("click")}function S(){_.value||(_.value=new Promise((e=>{const l=s(p.name),a=oe(p.duration)?p.duration.enter:p.duration;y.value="enter",k("before-enter"),ie((()=>{k("enter"),w.value=l.enter,b.value=a,ie((()=>{f.value=!0,h.value=!0,ie((()=>{g.value=!1,w.value=l["enter-to"],e()}))}))}))})))}function I(){g.value||(g.value=!0,"leave"===y.value?k("after-leave"):"enter"===y.value&&k("after-enter"),!p.show&&h.value&&(h.value=!1))}return i((()=>{p.show&&S()})),v((()=>p.show),(e=>{e?S():_.value&&_.value.then((()=>{if(!h.value)return;const e=s(p.name),l=oe(p.duration)?p.duration.leave:p.duration;y.value="leave",k("before-leave"),ie((()=>{k("leave"),w.value=e.leave,b.value=l,ie((()=>{g.value=!1,setTimeout((()=>{I(),_.value=null}),b.value),w.value=e["leave-to"]}))}))}))}),{deep:!0,immediate:!0}),(e,l)=>{const s=n;return f.value?(a(),t(s,{key:0,class:c($.value),style:r(V.value),onTransitionend:I,onClick:x},{default:o((()=>[C(e.$slots,"default",{},void 0,!0)])),_:3},8,["class","style"])):m("",!0)}}}),[["__scopeId","data-v-09a909c1"]]);const xe=L(e({name:"wd-overlay",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...G,show:U(!1),duration:{type:[Object,Number,Boolean],default:300},lockScroll:U(!0),zIndex:ee(10)},emits:["click"],setup(e,{emit:s}){const n=e,u=s;function i(){u("click")}function r(){}return function(e){const l=d(0),a=()=>{0===l.value&&(document.getElementsByTagName("body")[0].style.overflow="hidden"),l.value++},t=()=>{l.value>0&&(l.value--,0===l.value&&(document.getElementsByTagName("body")[0].style.overflow=""))};v(e,(e=>{e?a():t()}))}((()=>n.show&&n.lockScroll)),(e,s)=>{const n=N(l("wd-transition"),$e);return a(),t(n,{show:e.show,name:"fade","custom-class":"wd-overlay",duration:e.duration,"custom-style":`z-index: ${e.zIndex}; ${e.customStyle}`,onClick:i,onTouchmove:s[0]||(s[0]=V((l=>e.lockScroll?r:""),["stop","prevent"]))},{default:o((()=>[C(e.$slots,"default",{},void 0,!0)])),_:3},8,["show","duration","custom-style"])}}}),[["__scopeId","data-v-2842228e"]]),Se=L(e({name:"wd-popup",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...G,transition:String,closable:U(!1),position:Z("center"),closeOnClickModal:U(!0),duration:{type:[Number,Boolean],default:300},modal:U(!0),zIndex:ee(10),hideWhenClose:U(!0),modalStyle:Z(""),safeAreaInsetBottom:U(!1),modelValue:U(!1),lazyRender:U(!0),lockScroll:U(!0)},emits:["update:modelValue","before-enter","enter","before-leave","leave","after-leave","after-enter","click-modal","close"],setup(e,{emit:s}){const f=e,y=e=>e?{enter:`wd-${e}-enter wd-${e}-enter-active`,"enter-to":`wd-${e}-enter-to wd-${e}-enter-active`,leave:`wd-${e}-leave wd-${e}-leave-active`,"leave-to":`wd-${e}-leave-to wd-${e}-leave-active`}:{enter:"enter-class enter-active-class","enter-to":"enter-to-class enter-active-class",leave:"leave-class leave-active-class","leave-to":"leave-to-class leave-active-class"},g=d(!1),b=d(!1),w=d(""),_=d(!1),k=d(300),V=d(""),x=d(0),S=d(""),I=s,z=u((()=>`z-index: ${f.zIndex}; padding-bottom: ${x.value}px; -webkit-transition-duration: ${k.value}ms; transition-duration: ${k.value}ms; ${b.value||!f.hideWhenClose?"":"display: none;"} ${f.customStyle}`)),T=u((()=>`wd-popup wd-popup--${f.position} ${f.customClass||""} ${V.value||""}`));function K(){const e=y(f.transition||f.position),l="none"===f.transition?0:oe(f.duration)?f.duration.enter:f.duration;w.value="enter",I("before-enter"),ie((()=>{I("enter"),V.value=e.enter,k.value=l,ie((()=>{g.value=!0,b.value=!0,ie((()=>{_.value=!1,V.value=e["enter-to"]}))}))}))}function A(){_.value||(_.value=!0,"leave"===w.value?I("after-leave"):"enter"===w.value&&I("after-enter"),!f.modelValue&&b.value&&(b.value=!1))}function j(){const{transition:e,position:l}=f;S.value=e||l}function B(){I("click-modal"),f.closeOnClickModal&&O()}function O(){I("close"),I("update:modelValue",!1)}function F(){}return i((()=>{if(j(),f.safeAreaInsetBottom){const{safeArea:e,screenHeight:l,safeAreaInsets:a}=$();x.value=e&&a?a.bottom:0}f.modelValue&&K()})),v((()=>f.modelValue),(e=>{e?K():function(){if(!b.value)return;const e=y(f.transition||f.position),l="none"===f.transition?0:oe(f.duration)?f.duration.leave:f.duration;w.value="leave",I("before-leave"),ie((()=>{I("leave"),V.value=e.leave,k.value=l,ie((()=>{_.value=!1;const l=setTimeout((()=>{A(),clearTimeout(l)}),k.value);V.value=e["leave-to"]}))}))}()}),{deep:!0,immediate:!0}),v([()=>f.position,()=>f.transition],(()=>{j()}),{deep:!0,immediate:!0}),(e,s)=>{const u=N(l("wd-overlay"),xe),i=N(l("wd-icon"),H),d=n;return a(),p(h,null,[e.modal?(a(),t(u,{key:0,show:e.modelValue,"z-index":e.zIndex,"lock-scroll":e.lockScroll,duration:e.duration,"custom-style":e.modalStyle,onClick:B,onTouchmove:F},null,8,["show","z-index","lock-scroll","duration","custom-style"])):m("",!0),!e.lazyRender||g.value?(a(),t(d,{key:1,class:c(T.value),style:r(z.value),onTransitionend:A},{default:o((()=>[C(e.$slots,"default",{},void 0,!0),e.closable?(a(),t(i,{key:0,"custom-class":"wd-popup__close",name:"add",onClick:O})):m("",!0)])),_:3},8,["class","style"])):m("",!0)],64)}}}),[["__scopeId","data-v-35efe4c2"]]),Ie=L(e({name:"wd-picker",options:{virtualHost:!0,addGlobalClass:!0,styleIsolation:"shared"},props:{...G,customLabelClass:Z(""),customValueClass:Z(""),customViewClass:Z(""),label:String,placeholder:String,disabled:U(!1),readonly:U(!1),loading:U(!1),loadingColor:Z("#4D80F0"),title:String,cancelButtonText:String,confirmButtonText:String,required:U(!1),size:String,labelWidth:String,useDefaultSlot:U(!1),useLabelSlot:U(!1),error:U(!1),alignRight:U(!1),beforeConfirm:Function,closeOnClickModal:U(!0),safeAreaInsetBottom:U(!0),ellipsis:U(!1),columnsHeight:ee(217),valueKey:Z("value"),labelKey:Z("label"),modelValue:{type:[String,Number,Array],default:""},columns:{type:Array,default:()=>[]},columnChange:Function,displayFormat:Function,zIndex:ee(15),prop:String,rules:le()},emits:["confirm","open","cancel","update:modelValue"],setup(e,{expose:f,emit:g}){const{translate:k}=fe("picker"),V=e,$=d(null),I=ve(),z=d(!1),T=d(!1),K=d(""),A=d(""),j=d([]),B=d([]),O=d(!1),F=d(!1),E=g,P=u((()=>V.loading||z.value));v((()=>V.displayFormat),(e=>{e&&!Q(e)&&console.error("The type of displayFormat must be Function"),$.value&&$.value.selectedIndex&&0!==$.value.selectedIndex.length&&(re(V.modelValue)&&""!==V.modelValue?X($.value.getSelects()):K.value="")}),{immediate:!0,deep:!0}),v((()=>V.modelValue),(e=>{A.value=e,re(e)&&""!==e?$.value&&$.value.getSelects?y((()=>{X($.value.getSelects())})):X(R(e)):K.value=""}),{deep:!0,immediate:!0}),v((()=>V.columns),(e=>{j.value=e,B.value=e,re(V.modelValue)&&""!==V.modelValue?$.value&&$.value.getSelects?y((()=>{X($.value.getSelects())})):X(R(V.modelValue)):K.value=""}),{deep:!0,immediate:!0}),v((()=>V.columnChange),(e=>{e&&!Q(e)&&console.error("The type of columnChange must be Function")}),{deep:!0,immediate:!0});const{parent:L}=pe(me),D=u((()=>L&&V.prop&&L.errorMessages&&L.errorMessages[V.prop]?L.errorMessages[V.prop]:"")),q=u((()=>{let e=!1;if(L&&L.props.rules){const l=L.props.rules;for(const a in l)Object.prototype.hasOwnProperty.call(l,a)&&a===V.prop&&Array.isArray(l[a])&&(e=l[a].some((e=>e.required)))}return V.required||V.rules.some((e=>e.required))||e})),{proxy:M}=_();function R(e){const l=Ce(V.columns,V.valueKey,V.labelKey);if(0===V.columns.length)return;if(""===e||!re(e)||ae(e)&&0===e.length)return;const a=te(e);if(-1===["string","number","boolean","array"].indexOf(a))return[];0===(e=(e=ae(e)?e:[e]).slice(0,l.length)).length&&(e=l.map((()=>0)));let t=[];e.forEach(((e,a)=>{let o=l[a].findIndex((l=>l[V.valueKey].toString()===e.toString()));o=-1===o?0:o,t.push(o)}));const o=t.map(((e,a)=>l[a][e]));return 1===o.length?o[0]:o}function W(){V.disabled||V.readonly||(E("open"),T.value=!0,A.value=V.modelValue,j.value=B.value)}function G(){T.value=!1,E("cancel")}function U(){if(P.value)return;if(O.value)return void(F.value=!0);const{beforeConfirm:e}=V;e&&Q(e)?e(A.value,(e=>{e&&J()}),M.$.exposed):J()}function J(){if(P.value||V.disabled)return void(T.value=!1);const e=$.value.getSelects(),l=$.value.getValues(),a=$.value.getColumnsData();T.value=!1,B.value=se(a),E("update:modelValue",l),X(e),E("confirm",{value:l,selectedItems:e})}function Y({value:e}){A.value=e}function X(e){if(ae(e)&&!e.length||!e)return;const{valueKey:l,labelKey:a}=V;K.value=(V.displayFormat||ce)(e,{valueKey:l,labelKey:a})}function Z(){}function ee(){O.value=!0}function le(){O.value=!1,F.value&&(F.value=!1,U())}return x((()=>{re(V.modelValue)&&""!==V.modelValue&&X(R(V.modelValue)),re(V.modelValue)&&""!==V.modelValue&&$.value&&$.value.getSelects&&X($.value.getSelects())})),i((()=>{j.value=se(V.columns),B.value=se(V.columns)})),f({close:function(){G()},open:function(){W()},setLoading:function(e){z.value=e}}),(e,u)=>{const i=n,d=N(l("wd-icon"),H),v=N(l("wd-picker-view"),Ve),f=N(l("wd-popup"),Se);return a(),t(i,{class:c(`wd-picker ${e.disabled?"is-disabled":""} ${e.size?"is-"+e.size:""}  ${S(I).border.value?"is-border":""} ${e.alignRight?"is-align-right":""} ${e.error?"is-error":""} ${e.customClass}`),style:r(e.customStyle)},{default:o((()=>[s(i,{class:"wd-picker__field",onClick:W},{default:o((()=>[e.useDefaultSlot?C(e.$slots,"default",{key:0},void 0,!0):(a(),t(i,{key:1,class:"wd-picker__cell"},{default:o((()=>[e.label||e.useLabelSlot?(a(),t(i,{key:0,class:c(`wd-picker__label ${e.customLabelClass}  ${q.value?"is-required":""}`),style:r(e.labelWidth?"min-width:"+e.labelWidth+";max-width:"+e.labelWidth+";":"")},{default:o((()=>[e.label?(a(),p(h,{key:0},[b(w(e.label),1)],64)):C(e.$slots,"label",{key:1},void 0,!0)])),_:3},8,["class","style"])):m("",!0),s(i,{class:"wd-picker__body"},{default:o((()=>[s(i,{class:"wd-picker__value-wraper"},{default:o((()=>[s(i,{class:c(`wd-picker__value ${e.ellipsis&&"is-ellipsis"} ${e.customValueClass} ${K.value?"":"wd-picker__placeholder"}`)},{default:o((()=>[b(w(K.value?K.value:e.placeholder||S(k)("placeholder")),1)])),_:1},8,["class"]),e.disabled||e.readonly?m("",!0):(a(),t(d,{key:0,"custom-class":"wd-picker__arrow",name:"arrow-right"}))])),_:1}),D.value?(a(),t(i,{key:0,class:"wd-picker__error-message"},{default:o((()=>[b(w(D.value),1)])),_:1})):m("",!0)])),_:1})])),_:3}))])),_:3}),s(f,{modelValue:T.value,"onUpdate:modelValue":u[1]||(u[1]=e=>T.value=e),position:"bottom","hide-when-close":!1,"close-on-click-modal":e.closeOnClickModal,"z-index":e.zIndex,"safe-area-inset-bottom":e.safeAreaInsetBottom,onClose:G,"custom-class":"wd-picker__popup"},{default:o((()=>[s(i,{class:"wd-picker__wraper"},{default:o((()=>[s(i,{class:"wd-picker__toolbar",onTouchmove:Z},{default:o((()=>[s(i,{class:"wd-picker__action wd-picker__action--cancel",onClick:G},{default:o((()=>[b(w(e.cancelButtonText||S(k)("cancel")),1)])),_:1}),e.title?(a(),t(i,{key:0,class:"wd-picker__title"},{default:o((()=>[b(w(e.title),1)])),_:1})):m("",!0),s(i,{class:c("wd-picker__action "+(P.value?"is-loading":"")),onClick:U},{default:o((()=>[b(w(e.confirmButtonText||S(k)("done")),1)])),_:1},8,["class"])])),_:1}),s(v,{ref_key:"pickerViewWd",ref:$,"custom-class":e.customViewClass,modelValue:A.value,"onUpdate:modelValue":u[0]||(u[0]=e=>A.value=e),columns:j.value,loading:P.value,"loading-color":e.loadingColor,"columns-height":e.columnsHeight,"value-key":e.valueKey,"label-key":e.labelKey,onChange:Y,onPickstart:ee,onPickend:le,"column-change":e.columnChange},null,8,["custom-class","modelValue","columns","loading","loading-color","columns-height","value-key","label-key","column-change"])])),_:1})])),_:1},8,["modelValue","close-on-click-modal","z-index","safe-area-inset-bottom"])])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-61974ea3"]]),ze=L(e({__name:"publish",setup(e){const i=I.database(),r=z({title:"",is_open:!0,classify_id:"",content:"",excerpt:"",picurls:[],province:"",tag:""}),c=d(""),v=d(!0),m=d(!1),f=ye.checkCache("acticleId"),y=d("");let g=d([]);const w=d(),_=u((()=>!!m.value||(!r.title||!r.content))),k=e=>{r.content=e.html,r.excerpt=e.text.slice(0,160)},C=()=>{const e=ye.get("currentRoute");ye.remove("acticleId"),e.includes("my-article")&&A({url:`${e}`}),A({url:`/pages/${e}/${e}`,success(){T()}})},V=()=>{A({url:"/pages/home/home",success(){ye.remove("acticleId"),T()}})},$=()=>{const{title:e,content:l}=r;if(!e||!l)return C();j({content:"是否存为草稿？",cancelText:"不保存",confirmText:"保存",success:e=>{e.confirm&&x(0),e.cancel&&C()}})},x=(e=1)=>{r.picurls=we(r.content,9),m.value=!0;const l=i.collection("travel-articles");(f?l.doc(y.value).update({...r,article_status:e}):l.add({...r,article_status:e})).then((e=>{console.log("==== 发布",e),O({title:"保存成功",icon:"none"}),setTimeout((()=>{m.value=!1,V()}),1500)})).catch((()=>{O({title:"保存失败，请联系管理员",icon:"none"}),m.value=!1}))};E((()=>{(async()=>{ge().hasLogin&&(K({animation:!0}),v.value=!0,r.province=await be(),i.collection("travel-classify").where("user_id == $cloudEnv_uid && delete_status == 1").get().then((e=>{e.result.data.length>0&&(g.value=e.result.data)})))})(),f&&(y.value=ye.get("acticleId"),i.collection("travel-articles").where(`_id == "${y.value}"`).get({getOne:!0}).then((e=>{const{content:l,excerpt:a,title:t,is_open:o="",classify_id:s=""}=e.result.data;r.title=t,r.content=l,r.excerpt=a,r.is_open=o,r.classify_id=s,c.value=l})).catch((e=>{console.log(e),O({title:"获取内容详情失败，请联系管理员！",icon:"none"})})))})),P((()=>{T()}));const L=d([{label:"竞赛",value:"competition"},{label:"科研",value:"science"},{label:"创业",value:"job"}]);return(e,u)=>{const i=N(l("wd-navbar-capsule"),_e),d=N(l("wd-navbar"),D),v=N(l("unregistered-page"),q),m=n,f=N(l("wd-icon"),H),y=F,C=N(l("wd-input"),R),I=N(l("wd-switch"),ke),z=N(l("wd-cell"),de),T=N(l("wd-picker"),Ie),K=N(l("wd-form"),W),A=N(l("custom-editor"),he);return a(),p(h,null,[s(d,{title:"发布",fixed:"",placeholder:"",zIndex:100,safeAreaInsetTop:"","custom-style":"background-color: #f8f8f8;"},{capsule:o((()=>[s(i,{onBack:$,onBackHome:V})])),_:1}),S(ge)().hasLogin?(a(),t(m,{key:1,class:"content"},{default:o((()=>[s(m,{class:"header-seat"},{default:o((()=>[s(m,{class:"operation-area"},{default:o((()=>[s(m,{class:"ai-btn",onClick:u[0]||(u[0]=e=>{B({url:"/subpackages/sub_publish/chat/chat"})})}),s(y,{class:"submit-btn",disabled:_.value,onClick:u[1]||(u[1]=e=>x())},{default:o((()=>[s(f,{name:"file-paste",size:"28rpx"}),b(" 确认")])),_:1},8,["disabled"])])),_:1}),s(K,{ref:"form",model:r},{default:o((()=>[s(C,{label:"标题","label-width":"100px",maxlength:100,"show-word-limit":"",clearable:"",modelValue:r.title,"onUpdate:modelValue":u[2]||(u[2]=e=>r.title=e),placeholder:"请输入标题"},null,8,["modelValue"]),s(z,{title:"是否公开","title-width":"100px",center:""},{default:o((()=>[s(m,{style:{"text-align":"left"}},{default:o((()=>[s(I,{modelValue:r.is_open,"onUpdate:modelValue":u[3]||(u[3]=e=>r.is_open=e)},null,8,["modelValue"])])),_:1})])),_:1}),s(T,{label:"标签",placeholder:"请选择标签","label-width":"100px","value-key":"label","label-key":"label",size:"large",clearable:"",modelValue:r.tag,"onUpdate:modelValue":u[4]||(u[4]=e=>r.tag=e),columns:L.value},null,8,["modelValue","columns"]),s(T,{label:"我的分类",placeholder:"请选择分类 (默认为其他)","label-width":"100px","value-key":"_id","label-key":"categoryName",size:"large",clearable:"",modelValue:r.classify_id,"onUpdate:modelValue":u[5]||(u[5]=e=>r.classify_id=e),columns:S(g)},null,8,["modelValue","columns"])])),_:1},8,["model"])])),_:1}),s(m,{class:"edit-box"},{default:o((()=>[s(A,{ref_key:"editComp",ref:w,editorContent:c.value,onSetEditerValue:k},null,8,["editorContent"])])),_:1})])),_:1})):(a(),t(v,{key:0}))],64)}}}),[["__scopeId","data-v-eb2e2e02"]]);export{ze as default};
