import{d as e,Y as a,h as t,J as s,j as l,o as i,m as o,e as c,u as r,w as n,F as u,p as d,f as p,t as f,M as m,W as _,L as v,i as g,a as b,k as h,N as k,x,y as j,z as y,s as C}from"./index-CKmb8B-R.js";import{_ as w}from"./wd-navbar.w8falpwB.js";import{b as I,c as z,a as L,r as S}from"./uni-app.es.C8008jpp.js";import{t as A,s as B}from"./index.B98IQ2cJ.js";import{_ as E}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./wd-icon.CKzk4z_r.js";import"./props.DIUoDIPf.js";import"./config.defalut.Bve--ZPF.js";const M=E(e({__name:"my-article",setup(e){const E=a.database();let M="";const $=t([]),D=t(""),F=s({page:1,pageSize:20,total:0}),J=()=>{const{pageSize:e,page:a}=F;D.value="加载中...";E.collection("travel-articles").where("article_status == 0 && user_id == $cloudEnv_uid && delete_status == 1").field("title, publish_date, user_id").orderBy("publish_date","desc").skip((a-1)*e).limit(e).get({getCount:!0}).then((e=>{var t,s;F.total=(null==(t=e.result)?void 0:t.count)||0,$.value=1===a?(null==(s=e.result)?void 0:s.data)||[]:$.value.concat(e.result.data)})).finally((()=>{e*a<F.total?D.value="上拉加载更多":D.value="暂无更多数据",m()}))},K=e=>{x({itemList:["删除","编辑"],success:function(a){var t;0===a.tapIndex&&(e=>{y({title:"是否确认删除？此操作不可逆！",success(a){a.confirm&&E.collection("travel-articles").doc(e).remove().then((()=>{C({title:"删除成功！",icon:"none"})})).catch((e=>{C({title:e.message||"删除失败，请联系管理员",icon:"none"})})).finally((()=>{F.page=1,J()}))}})})(e),1===a.tapIndex&&(t=e,B.set("currentRoute",`/subpackages/sub_mine/my-article/my-article?title=${M}&code=draft`),B.set("acticleId",t),j({url:"/pages/publish/publish"}))},fail:function(e){console.log(e.errMsg)}})},N=()=>{_({url:"/pages/mine/mine",success(){v()}})};return I((()=>{F.page=1,J()})),z((()=>{const{total:e,page:a,pageSize:t}=F;e>a*t&&(F.page++,J())})),L((e=>{M=null==e?void 0:e.title,J()})),(e,a)=>{const t=S(l("wd-navbar"),w),s=g;return i(),o(u,null,[c(t,{title:r(M),fixed:"",placeholder:"",zIndex:100,bordered:!1,"left-arrow":"",safeAreaInsetTop:"","custom-style":"background-color: #f8f8f8;",onClickLeft:N},null,8,["title"]),c(s,{class:"content"},{default:n((()=>[c(s,{class:"list"},{default:n((()=>[(i(!0),o(u,null,d($.value,(e=>(i(),b(s,{class:"li",key:e._id,onClick:a=>{return t=e._id,void k({url:"/subpackages/sub_home/article-details/article-details?id="+t});var t}},{default:n((()=>[c(s,{class:"li-title"},{default:n((()=>[p(f(e.title),1)])),_:2},1024),c(s,{class:"li-foot"},{default:n((()=>[c(s,{class:"li-time"},{default:n((()=>[p(f(r(A)(e.publish_date)),1)])),_:2},1024),c(s,{class:"more-action",onClick:h((a=>K(e._id)),["stop"])},{default:n((()=>[p("···")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["onClick"])))),128)),c(s,{class:"load-text"},{default:n((()=>[p(f(D.value),1)])),_:1})])),_:1})])),_:1})],64)}}}),[["__scopeId","data-v-a856decb"]]);export{M as default};
