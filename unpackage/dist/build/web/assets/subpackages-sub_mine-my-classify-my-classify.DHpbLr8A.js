import{d as a,Y as e,h as s,J as t,o as l,a as i,w as o,e as c,m as n,p as u,F as d,f as r,t as p,M as f,i as _,u as g,k as m,N as v,x as y,z as h,s as k}from"./index-BKu2siHj.js";import{b as x,c as b,a as C}from"./uni-app.es.D1_Kkzeg.js";import{t as j}from"./index.CapNOk9P.js";import{_ as z}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./config.defalut.DCXQerkV.js";const I=z(a({__name:"my-classify",setup(a){const z=e.database(),I=s([]),N=s(""),S=t({page:1,pageSize:20,total:0}),w=()=>{const{pageSize:a,page:e}=S;N.value="加载中...",z.collection("travel-classify").where("user_id == $cloudEnv_uid && delete_status == 1").field("categoryName, publish_date, user_id").orderBy("publish_date","desc").skip((e-1)*a).limit(a).get({getCount:!0}).then((a=>{var s,t;S.total=(null==(s=a.result)?void 0:s.count)||0,I.value=1===e?(null==(t=a.result)?void 0:t.data)||[]:I.value.concat(a.result.data)})).finally((()=>{a*e<S.total?N.value="上拉加载更多":N.value="暂无更多数据",f()}))},B=a=>{v({url:"/subpackages/sub_categories/categories-add/categories-add?id="+a})},E=a=>{y({itemList:["删除","编辑"],success:function(e){0===e.tapIndex&&(a=>{h({title:"是否确认删除？此操作会删除当前分类及其分类下的所有内容，操作不可逆！",success(e){e.confirm&&z.collection("travel-classify").doc(a).remove().then((()=>{k({title:"删除成功！",icon:"none"})})).catch((a=>{k({title:a.message||"删除失败，请联系管理员",icon:"none"})})).finally((()=>{S.page=1,w()}))}})})(a),1===e.tapIndex&&B(a)},fail:function(a){console.log(a.errMsg)}})};return x((()=>{S.page=1,w()})),b((()=>{const{total:a,page:e,pageSize:s}=S;a>e*s&&(S.page++,w())})),C((a=>{null==a||a.title,w()})),(a,e)=>{const s=_;return l(),i(s,{class:"content"},{default:o((()=>[c(s,{class:"list"},{default:o((()=>[(l(!0),n(d,null,u(I.value,(a=>(l(),i(s,{class:"li",key:a._id,onClick:e=>B(a._id)},{default:o((()=>[c(s,{class:"li-title"},{default:o((()=>[r(p(a.categoryName),1)])),_:2},1024),c(s,{class:"li-foot"},{default:o((()=>[c(s,{class:"li-time"},{default:o((()=>[r(p(g(j)(a.publish_date)),1)])),_:2},1024),c(s,{class:"more-action",onClick:m((e=>E(a._id)),["stop"])},{default:o((()=>[r("···")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1032,["onClick"])))),128)),c(s,{class:"load-text"},{default:o((()=>[r(p(N.value),1)])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-de24c099"]]);export{I as default};
